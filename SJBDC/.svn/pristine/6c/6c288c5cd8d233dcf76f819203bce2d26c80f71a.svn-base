<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="BigShowYwjgQueryMapper">
	<resultMap id="BaseResultMap" type="java.util.Map"></resultMap>
		<!--big ywjg 异常huizong 首页-->
	<select id="queryYCZLForIndex" resultMap="BaseResultMap" parameterType="java.util.Map">
		 select * from (select ycdm, count(*) value
           from bdcdj_check t
          where 1 = 1  
          <if test="cityCode!=null and cityCode!=null">
         	  and (t.qxdm=#{cityCode}  or pqxdm=#{cityCode} )
          </if>
          <if test = "startDate!=null and startDate!='' and endDate !=null and endDate!=''">
		        and t.sjrksj between to_date(#{startDate}, 'YYYY-MM-DD') and to_date(#{endDate}, 'YYYY-MM-DD')
		 </if>
          group by ycdm) pivot(sum(value) for ycdm in(201,202,203,204,205))
	</select>
	
	<!-- 查询办理情况（9大登记）模块 -->
	<select id="queryYwblqk" resultMap="BaseResultMap" parameterType="java.util.Map">
				                 select 
					                    nvl(sum(t.ywl),0) ywl,
					                    nvl(sum(t.scdj),0) scdj,
					                    nvl(sum(zydj),0) zydj,
					                    nvl(sum(t.BGDJ),0) bgdj,
					                    nvl(sum(t.ZXDJ),0) zxdj,
					                    nvl(sum(t.GZDJ),0) gzdj,
					                    nvl(sum(t.yydj),0) yydj,
					                    nvl(sum(t.YGDJ),0) ygdj,
					                    nvl(sum(t.CFDJ),0) cfdj,
					                    nvl(sum(t.QTDJ),0) qtdj
					               from jg_ywl_union_v t
					               where 1=1
					               <if test="cityCode!=null and cityCode!=''">
					               and pqxdm=${cityCode}
					               </if>
					               <if test="startDate!=null and endDate!=null and startDate!='' and endDate!=''">
							       and to_date(t.tjsj,'yyyy-MM-dd') between to_date(#{startDate}, 'YYYY-MM-DD') and to_date(#{endDate}, 'YYYY-MM-DD')
						           </if>
	</select>
	
	  <!--查询企业印制绩效-->   
	<select id="queryQYYZJX" resultMap="BaseResultMap" parameterType="java.util.Map">		 
		 select y.yzqy, avg(nt.yzdf) yzdf, avg(nt.ycdf) ycdf
		  from bdcdj_zs_qy y,
		       (select t.id,
		               CASE
		                 WHEN ((sum(t.lzsl) / sum(t.jfsl) / 0.01)) > 1 THEN
		                  (50 - (sum(t.lzsl) / sum(t.jfsl) / 0.01))
                     else
                      50
                   end yzdf,           
                   (50 -
                   (select pc.ycjfts from bdcdj_zs_pc pc where pc.ywbsid = t.id)) ycdf,
                   (select pc.qyid from bdcdj_zs_pc pc where pc.ywbsid = t.id) qyid
              from (select f.jfsl,
                           p.ywbsid id,
                           (select count(*)
                              from bdcdj_zs_xx x
                             where x.zszt = 3
                               and x.pcflid = f.ywbsid) lzsl
                      from bdcdj_zs_pc p, bdcdj_zs_pcfl f
                     where f.pcid = p.ywbsid                    
                       <if test="year!=null and year!=''">
		                 	and p.pcnd=#{year}
		                 </if>                     
                     ) t
             group by t.id) nt
     where y.ywbsid = nt.qyid
     group by y.yzqy
	</select>
	<!--业务受理  （业务受理总量，业务异常总量，平均效能）-->
	<select id="queryYwsl" resultMap="BaseResultMap" parameterType="java.util.Map">	
			select ywzl,
			       yczl
			       <if test="startDate!=null and startDate!='' and endDate!=null and  endDate!=''">
			        ,ywzl /(select to_date(#{endDate}, 'yyyy-MM-dd')-to_date(#{startDate}, 'yyyy-MM-dd') from dual)
			        as pjxn
			       </if>
			  from
			   (select sum(ywl) as ywzl from JG_YWL_UNION_V 
			  where 1=1 
			  <if test="startDate!=null and  startDate!='' and endDate!=null and  endDate!=''">
			  and to_date(tjsj,'yyyy-MM-dd') between to_date(#{startDate}, 'yyyy-MM-dd')
			  and to_date(#{endDate}, 'yyyy-MM-dd')
			 </if>
			 <if test="cityCode!=null and cityCode!=''">
			 and pqxdm =#{cityCode}
			 </if>
			 ),
			       (select count(1) yczl from bdcdj_check 
			       where 1=1
			       <if test="cityCode!=null and cityCode!=''">
			       and pqxdm =#{cityCode}
			       </if>			       
			       <if test="startDate!=null and  startDate!='' and endDate!=null and  endDate!=''">
			        and fxsj between to_date(#{startDate}, 'yyyy-MM-dd')
			         and to_date(#{endDate}, 'yyyy-MM-dd')
			       </if>
			         ) 
       </select>
       
       
         <!-- 证书监管 已使用 已废弃 未使用 --> 
         <select id="queryZSjg" resultMap="BaseResultMap" parameterType="java.util.Map">	
			  select gyzzs,
			           yfq,
			           ysy,
			           (gyzzs - yfq - ysy) wsy
			    from (select nvl(count(*), 0) ysy from ZSXX where zszt = '1'),
			         (select nvl(count(*), 0) yfq from ZSXX where zszt = '2'),
			         (select nvl(sum(JFSL), 0) gyzzs from ZSYZXX)
       </select>
       
       <!-- 房屋用途  -->
       <select id="queryFwyt" resultMap="BaseResultMap" parameterType="java.util.Map">
				select (sum(zz) + sum(gy) + sum(sy) + sum(jy) + sum(wh) + sum(bg) + sum(js) +
				       sum(qt)) as zl,--总量
				       sum(zz) zz,--住宅
				       sum(gy) gy,--工业
				       sum(sy) sy,--商业
				       sum(jy) jy,--教育
				       sum(wh) wh,--文化
				       sum(bg) bg,--办公
				       sum(js) js,--军事
				       sum(qt) qt --其他
				  from JG_FWYT_UNION_V
				  where 1=1
				  <if test="cityCode!=null and cityCode!=''">
				   and pqxdm = ${cityCode}
				  </if>
				  <if test="startDate!=null and startDate!='' and endDate!=null and endDate!=''">
				  and to_date(tjsj,'yyyy-MM-dd') between to_date(#{startDate},'yyyy-MM-dd') and  to_date(#{endDate},'yyyy-MM-dd')
				  </if>
       </select>
</mapper>