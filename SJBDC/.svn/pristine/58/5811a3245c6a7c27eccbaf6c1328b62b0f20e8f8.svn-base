<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="BigShowSjjhQueryMapper">
<resultMap id="BaseResultMap" type="java.util.Map" ></resultMap>	
	<!-- big 大屏展示 数据交换首页 -->
	<select id="queryTotalJhsj" resultMap="BaseResultMap" parameterType="java.util.Map">
		select sum(hjzs) hjzs,sum(sbzs) sbzs,sum(rkzs) rkzs from jh_ztqk
		where 1=1
		<if test="cityCode!=null and cityCode!=''">
		  and (pxzqdm=#{cityCode} or xzqdm=#{cityCode})
		</if>
		 <if test = "starttime!=null and starttime!='' and endtime !=null and endtime!=''">
		         and TJSJ between to_date(#{starttime}, 'YYYY-MM-DD') and to_date(#{endtime}, 'YYYY-MM-DD')
		 </if>
	</select>
	
	<!-- 数据交换首页  接入情况  百分比 -->
	<select id="queryPercenForSJJH" resultMap="BaseResultMap" parameterType="java.util.Map">
	    select count(*) value from (
		select xzqmc from jh_ztqk t where hjzs>0 
		<if test="cityCode!=null and cityCode!=''">
			and t.pxzqdm=#{cityCode}
		</if>
		 group by t.xzqmc) 
		union all
		select count(*) value from dic_v_xzq_x x
		
		<if test="cityCode!=null and cityCode!=''">
			where x.PQXDM=#{cityCode}
		</if>
		 
	</select>
	<!--汇交排行 (汇交成功数量和失败数量) -->
	<select id="queryHJph" resultMap="BaseResultMap" parameterType="java.util.Map">
	 <choose>
      <when test="cityCode!=null and cityCode!=''">
           select sum(hjcgsl) as HJsuccess,
			       sum(hjycsl) as HJfail,
			       sum(hjzs) hjzs,
			       xzqdm
			  from JH_HJ_ZTQK
			 where pxzqdm = #{cityCode}
			 <if test="startDate!=null and  startDate!=''">
			 and tjsj between (to_date(#{startDate}, 'yyyy/mm/dd'))
			 </if>
			 <if test="endDate!=null and  endDate!=''">
			  and (to_date(#{endDate}, 'yyyy/mm/dd'))
			  </if>
			 group by xzqdm
			 order by xzqdm desc
			 </when>
			 <otherwise>
			select sum(hjcgsl) as HJsuccess,
			       sum(hjycsl) as HJfail,
			       sum(hjzs) hjzs,
			       pxzqdm
			  from JH_HJ_ZTQK
			 where 1=1
			 <if test="startDate!=null and  startDate!=''">
			 tjsj between (to_date(#{startDate}, 'yyyy/mm/dd'))
			 </if>
			 <if test="endDate!=null and  endDate!=''">
			  and (to_date(#{endDate}, 'yyyy/mm/dd'))
			  </if>
			 group by pxzqdm
			 order by pxzqdm desc
			 </otherwise>
			 </choose>
	</select>
	
	<!-- 查询上报详情（上报成功数量和异常数量）-->
    <select id="querySBxq" resultMap="BaseResultMap" parameterType="java.util.Map">
            <choose>
            <when test="cityCode!=null and cityCode!=''">	
			select sum(sbcgsl) as SBsuccess,
			       sum(sbycsl) as SBfail,
			       sum(sbzs) sbzs,
			       xzqdm
			  from JH_SB_ZTQK
			 where pxzqdm = #{cityCode}
			 <if test="startDate!=null and  startDate!=''">
			 and tjsj between (to_date(#{startDate}, 'yyyy/mm/dd'))
			 </if>
			 <if test="endDate!=null and  endDate!=''">
			  and (to_date(#{endDate}, 'yyyy/mm/dd'))
			  </if>
			 group by xzqdm
			 order by sbzs desc	
			 </when>
            <otherwise>
			select sum(sbcgsl) as SBsuccess,
			       sum(sbycsl) as SBfail,
			       sum(sbzs) sbzs,
			       pxzqdm
			  from JH_SB_ZTQK
			 where 1=1
			 <if test="startDate!=null and  startDate!=''">
			 tjsj between (to_date(#{startDate}, 'yyyy/mm/dd'))
			 </if>
			 <if test="endDate!=null and  endDate!=''">
			  and (to_date(#{endDate}, 'yyyy/mm/dd'))
			  </if>
			 group by pxzqdm
			 order by sbzs desc
			 </otherwise>
			 </choose>	
	</select>
</mapper>